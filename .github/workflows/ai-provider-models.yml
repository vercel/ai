name: AI Provider Models

on:
  repository_dispatch:
    types: [ai_provider_models]

jobs:
  create-issue:
    name: 'Create Issue for Provider Model Changes'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/create-github-app-token@v2
        id: app-token
        with:
          app-id: ${{ vars.VERCEL_AI_SDK_GITHUB_APP_CLIENT_ID }}
          private-key: ${{ secrets.VERCEL_AI_SDK_GITHUB_APP_PRIVATE_KEY_PKCS8 }}

      - name: Create issue
        uses: actions/github-script@v7
        with:
          github-token: ${{ steps.app-token.outputs.token }}
          script: |
            const { provider, resultType, newModelIDs, obsoleteModelIDs } = context.payload.client_payload;

            const lines = [];
            lines.push(`**Provider:** \`${provider}\``);
            lines.push(`**Type:** ${resultType === 'new_provider' ? 'New provider' : 'Model list diff'}`);
            lines.push('');

            if (newModelIDs.length > 0) {
              lines.push('### New models');
              for (const id of newModelIDs) {
                lines.push(`- \`${id}\``);
              }
              lines.push('');
            }

            if (obsoleteModelIDs.length > 0) {
              lines.push('### Obsolete models');
              for (const id of obsoleteModelIDs) {
                lines.push(`- \`${id}\``);
              }
              lines.push('');
            }

            await github.rest.issues.create({
              owner: 'vercel',
              repo: 'ai',
              title: `ðŸ¤– Provider model changes - ${provider}`,
              body: lines.join('\n'),
              labels: ['maintenance'],
            });
