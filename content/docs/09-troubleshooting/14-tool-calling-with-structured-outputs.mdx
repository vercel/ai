---
title: Tool calling with generateObject and streamObject
description: Troubleshooting tool calling when combined with generateObject and streamObject
---

# Tool calling with generateObject and streamObject (structured outputs)

## Issue

You may want to combine tool calling with structured output generation. While `generateObject` and `streamObject` are designed specifically for structured outputs, they don't support tool calling.

## Background

To use tool calling with structured outputs, use `generateText` or `streamText` with the `experimental_output` option.

**Important**: When using `experimental_output` with tool calling, the structured output generation counts as an additional step in the execution flow.

## Solution

When using `experimental_output` with tool calling, adjust your `stopWhen` condition to account for the additional step required for structured output generation:

```tsx
const result = await generateText({
  model: openai('gpt-4o'),
  experimental_output: Output.object({
    schema: z.object({
      summary: z.string(),
      sentiment: z.enum(['positive', 'neutral', 'negative']),
    }),
  }),
  tools: {
    analyze: tool({
      description: 'Analyze data',
      inputSchema: z.object({
        data: z.string(),
      }),
      execute: async ({ data }) => {
        return { result: 'analyzed' };
      }),
    },
  },
  // Add at least 1 to your intended step count to account for structured output
  stopWhen: stepCountIs(3), // Now accounts for: tool call + tool result + structured output
  prompt: 'Analyze the data and provide a summary',
});
```

## Important: Tool Calls vs Structured Output

When a generation finishes with tool calls (finish reason: `tool-calls`), the structured output parsing is automatically skipped. This means:

- experimental_output will not inforce structured output when the LLM retunres with tool calls as a last message.
- This prevents unnecessary parsing of tool call responses that don't contain structured text output
- result.experimental_output will throw "No output specified"

example:

```tsx
const result = await generateText({
  model: openai('gpt-4o'),
  experimental_output: Output.object({
    schema: jsonSchema({
      type: 'object',
      properties: {
        response: {
          type: 'string',
          description: 'the ai response',
        }
      },
      required: ['result'],
    }),
  }),
  tools: {
    calculate: tool({
      description: 'Perform basic arithmetic calculations',
      inputSchema: jsonSchema({
        type: 'object',
        properties: {
          operation: {
            type: 'string',
            enum: ['add', 'subtract', 'multiply', 'divide'],
            description: 'The arithmetic operation to perform',
          },
          a: {
            type: 'number',
            description: 'First number',
          },
          b: {
            type: 'number',
            description: 'Second number',
          },
        },
        required: ['operation', 'a', 'b'],
      }),
    }),
  },
  prompt: 'Calculate 15 * 7',
});

// If the last step finished with tool calls:
// result.experimental_output will throw "No output specified"
// result.toolCalls and result.toolResults will contain the tool data

// If the last step finished with text:
// result.experimental_output will contain the parsed structured output
```

For more information about using structured outputs with `generateText` and `streamText` see [Generating Structured Data](/docs/ai-sdk-core/generating-structured-data#structured-outputs-with-generatetext-and-streamtext).
