---
title: Migrate AI SDK 4.0 to 5.0
description: Learn how to upgrade AI SDK 4.0 to 5.0.
---

# Migrate AI SDK 4.0 to 5.0

<Note>
  AI SDK 5.0 is a major release that introduces significant improvements in type
  safety, consistency, and developer experience. This guide will help you
  migrate from AI SDK 4.0 to 5.0.
</Note>

## Recommended Migration Process

1. Backup your project. If you use a versioning control system, make sure all previous versions are committed.
1. Upgrade to AI SDK 5.0.
1. Automatically migrate your code using [codemods](#codemods).
   > If you don't want to use codemods, we recommend resolving all TypeScript errors after upgrading to AI SDK 5.0.
1. Follow the breaking changes guide below.
1. Verify your project is working as expected.
1. Commit your changes.

## AI SDK 5.0 package versions

You need to update the following packages to the following versions in your `package.json` file(s):

- `ai` package: `5.0.*`
- `@ai-sdk/provider` package: `1.0.*`
- `@ai-sdk/provider-utils` package: `2.0.*`
- `@ai-sdk/*` packages: `2.0.*` (other `@ai-sdk` packages)

## Codemods

The AI SDK provides Codemod transformations to help upgrade your codebase when a
feature is deprecated, removed, or otherwise changed.

Codemods are transformations that run on your codebase programmatically. They
allow you to easily apply many changes without having to manually go through
every file.

<Note>
  Codemods are intended as a tool to help you with the upgrade process. They may
  not cover all of the changes you need to make. You may need to make additional
  changes manually.
</Note>

You can run all codemods provided as part of the 5.0 upgrade process by running
the following command from the root of your project:

```sh
npx @ai-sdk/codemod upgrade
```

Individual codemods can be run by specifying the name of the codemod:

```sh
npx @ai-sdk/codemod <codemod-name> <path>
```

See also the [table of codemods](#codemod-table).

## Package Structure Changes

### `@ai-sdk/rsc` Package Extraction

The `ai/rsc` export has been extracted to a separate package `@ai-sdk/rsc`.

```tsx filename="AI SDK 4.0"
import { createStreamableValue } from 'ai/rsc';
```

```tsx filename="AI SDK 5.0"
import { createStreamableValue } from '@ai-sdk/rsc';
```

<Note>Don't forget to install the new package: `npm install @ai-sdk/rsc`</Note>

**Codemod:** `rsc-package`

### React UI Hooks Moved to `@ai-sdk/react`

The deprecated `ai/react` export has been removed in favor of `@ai-sdk/react`.

```tsx filename="AI SDK 4.0"
import { useChat } from 'ai/react';
```

```tsx filename="AI SDK 5.0"
import { useChat } from '@ai-sdk/react';
```

<Note>
  Don't forget to install the new package: `npm install @ai-sdk/react`
</Note>

**Codemod:** `move-react-to-ai-sdk`

## useChat Changes

The `useChat` hook has undergone significant changes in v5, with new transport architecture and removal of managed input state.

### Chat Transport Architecture

Configuration is now handled through transport objects instead of direct API options.

```tsx filename="AI SDK 4.0"
import { useChat } from '@ai-sdk/react';

const { messages } = useChat({
  api: '/api/chat',
  credentials: 'include',
  headers: { 'Custom-Header': 'value' },
});
```

```tsx filename="AI SDK 5.0"
import { useChat, DefaultChatTransport } from '@ai-sdk/react';

const { messages } = useChat({
  transport: new DefaultChatTransport({
    api: '/api/chat',
    credentials: 'include',
    headers: { 'Custom-Header': 'value' },
  }),
});
```

### Removed Managed Input State

The `useChat` hook no longer manages input state internally. You must now manage input state manually.

```tsx filename="AI SDK 4.0"
import { useChat } from '@ai-sdk/react';

const { messages, input, handleInputChange, handleSubmit } = useChat({
  api: '/api/chat',
});

return (
  <form onSubmit={handleSubmit}>
    <input value={input} onChange={handleInputChange} />
    <button type="submit">Send</button>
  </form>
);
```

```tsx filename="AI SDK 5.0"
import { useChat, DefaultChatTransport } from '@ai-sdk/react';
import { useState } from 'react';

const [input, setInput] = useState('');
const { messages, sendMessage } = useChat({
  transport: new DefaultChatTransport({ api: '/api/chat' }),
});

const handleSubmit = e => {
  e.preventDefault();
  sendMessage([{ type: 'text', text: input }]);
  setInput('');
};

return (
  <form onSubmit={handleSubmit}>
    <input value={input} onChange={e => setInput(e.target.value)} />
    <button type="submit">Send</button>
  </form>
);
```

Key changes:

- `input`, `setInput`, `handleInputChange`, `handleSubmit` removed
- Use `sendMessage()` to send messages
- Messages are sent as parts arrays instead of strings

### Message Sending: `append` → `sendMessage`

The `append` function has been replaced with `sendMessage` and requires structured message format.

```tsx filename="AI SDK 4.0"
const { append } = useChat();

// Simple text message
append({ role: 'user', content: 'Hello' });

// With custom body
append(
  {
    role: 'user',
    content: 'Hello',
  },
  { body: { imageUrl: 'https://...' } },
);
```

```tsx filename="AI SDK 5.0"
const { sendMessage } = useChat();

// Simple text message
// Defaults to `user` role
sendMessage({
  parts: [{ type: 'text', text: 'Hello' }],
});

// With custom body (via request options)
sendMessage(
  { role: 'user', parts: [{ type: 'text', text: 'Hello' }] },
  { body: { imageUrl: 'https://...' } },
);
```

Migration steps:

1. Replace `append` with `sendMessage` in destructuring
2. Convert `content` strings to `parts` arrays
3. Move custom data to request options `body` parameter

### Message Regeneration: `reload` → `regenerate`

The `reload` function has been renamed to `regenerate` with enhanced functionality.

```tsx filename="AI SDK 4.0"
const { reload } = useChat();

// Regenerate last message
reload();
```

```tsx filename="AI SDK 5.0"
const { regenerate } = useChat();

// Regenerate last message
regenerate();

// Regenerate specific message
regenerate({ messageId: 'message-123' });
```

Migration steps:

1. Replace `reload` with `regenerate` in destructuring
2. Optionally use the new `messageId` parameter for targeted regeneration

### `@ai-sdk/vue` Changes

The Vue.js integration has been completely restructured, replacing the `useChat` composable with a `Chat` class.

#### useChat Composable Replaced with Chat Class

```vue filename="@ai-sdk/vue v1"
<script setup>
import { useChat } from '@ai-sdk/vue';

const { messages, input, handleSubmit } = useChat({
  api: '/api/chat',
});
</script>
```

```vue filename="@ai-sdk/vue v2"
<script setup>
import { Chat, DefaultChatTransport } from '@ai-sdk/vue';
import { ref } from 'vue';

const input = ref('');
const chat = new Chat({
  transport: new DefaultChatTransport({ api: '/api/chat' }),
});

const handleSubmit = () => {
  chat.sendMessage([{ type: 'text', text: input.value }]);
  input.value = '';
};
</script>
```

#### Message Structure Changes

Messages now use a `parts` array instead of a `content` string.

```vue filename="@ai-sdk/vue v1"
<template>
  <div v-for="message in messages" :key="message.id">
    <div>{{ message.role }}: {{ message.content }}</div>
  </div>
</template>
```

```vue filename="@ai-sdk/vue v2"
<template>
  <div v-for="message in chat.messages" :key="message.id">
    <div>{{ message.role }}:</div>
    <div v-for="part in message.parts" :key="part.type">
      <span v-if="part.type === 'text'">{{ part.text }}</span>
    </div>
  </div>
</template>
```

### `@ai-sdk/svelte` Changes

The Svelte integration has also been updated with new constructor patterns and readonly properties.

#### Constructor API Changes

```js filename="@ai-sdk/svelte v1"
import { chat } from '@ai-sdk/svelte';

const chatInstance = chat({
  api: '/api/chat',
});
```

```js filename="@ai-sdk/svelte v2"
import { chat, DefaultChatTransport } from '@ai-sdk/svelte'; // TODO: NEED TO VERIFY

const chatInstance = chat(() => ({
  transport: new DefaultChatTransport({ api: '/api/chat' }),
}));
```

#### Properties Made Readonly

Properties are now readonly and must be updated using setter methods.

```js filename="@ai-sdk/svelte v1"
// Direct property mutation was allowed
chatInstance.messages = [...chatInstance.messages, newMessage];
```

```js filename="@ai-sdk/svelte v2"
// Must use setter methods
chatInstance.setMessages([...chatInstance.messages, newMessage]);
```

#### Removed Managed Input

Like React and Vue, input management has been removed from the Svelte integration.

```js filename="@ai-sdk/svelte v1"
// Input was managed internally
const { messages, input, handleSubmit } = chatInstance;
```

```js filename="@ai-sdk/svelte v2"
// Must manage input state manually
let input = '';
const { messages, sendMessage } = chatInstance;

const handleSubmit = () => {
  sendMessage([{ type: 'text', text: input }]);
  input = '';
};
```

### `@ai-sdk/ui-utils` Package Removal

The `@ai-sdk/ui-utils` package has been removed and its exports moved to the main `ai` package.

```tsx filename="AI SDK 4.0"
import { getTextFromDataUrl } from '@ai-sdk/ui-utils';
```

```tsx filename="AI SDK 5.0"
import { getTextFromDataUrl } from 'ai';
```

**Codemod:** `move-ui-utils-to-ai`

### LangChain Adapter Moved to `@ai-sdk/langchain`

The `LangChainAdapter` has been moved to `@ai-sdk/langchain` and the API has been updated to use UI message streams.

```tsx filename="AI SDK 4.0"
import { LangChainAdapter } from 'ai';

const response = LangChainAdapter.toDataStreamResponse(stream);
```

```tsx filename="AI SDK 5.0"
import { toUIMessageStream } from '@ai-sdk/langchain';
import { createUIMessageStreamResponse } from 'ai';

const response = createUIMessageStreamResponse({
  stream: toUIMessageStream(stream),
});
```

<Note>
  Don't forget to install the new package: `npm install @ai-sdk/langchain`
</Note>

**Codemod:** `move-langchain-adapter`

### LlamaIndex Adapter Moved to `@ai-sdk/llamaindex`

The `LlamaIndexAdapter` has been extracted to a separate package `@ai-sdk/llamaindex` and follows the same UI message stream pattern.

```tsx filename="AI SDK 4.0"
import { LlamaIndexAdapter } from 'ai';

const response = LlamaIndexAdapter.toDataStreamResponse(stream);
```

```tsx filename="AI SDK 5.0"
import { toUIMessageStream } from '@ai-sdk/llamaindex';
import { createUIMessageStreamResponse } from 'ai';

const response = createUIMessageStreamResponse({
  stream: toUIMessageStream(stream),
});
```

<Note>
  Don't forget to install the new package: `npm install @ai-sdk/llamaindex`
</Note>

**Codemod:** `replace-llamaindex-adapter`

## Core API Changes

### Maximum Output Tokens

The `maxTokens` parameter has been renamed to `maxOutputTokens` for clarity.

```tsx filename="AI SDK 4.0"
const result = await generateText({
  model: openai('gpt-4o'),
  maxTokens: 1024,
  prompt: 'Hello, world!',
});
```

```tsx filename="AI SDK 5.0"
const result = await generateText({
  model: openai('gpt-4o'),
  maxOutputTokens: 1024,
  prompt: 'Hello, world!',
});
```

**Codemod:** `rename-max-tokens-to-max-output-tokens`

### Type System Changes

#### `CoreMessage` → `ModelMessage`

```tsx filename="AI SDK 4.0"
import { CoreMessage } from 'ai';
```

```tsx filename="AI SDK 5.0"
import { ModelMessage } from 'ai';
```

**Codemod:** `rename-core-message-to-model-message`

#### `Message` → `UIMessage`

```tsx filename="AI SDK 4.0"
import { Message, CreateMessage } from 'ai';
```

```tsx filename="AI SDK 5.0"
import { UIMessage, CreateUIMessage } from 'ai';
```

**Codemod:** `rename-message-to-ui-message`

#### Provider Metadata → Provider Options

The `providerMetadata` parameter has been renamed to `providerOptions`.

```tsx filename="AI SDK 4.0"
const result = await generateText({
  model: openai('gpt-4'),
  prompt: 'Hello',
  providerMetadata: {
    openai: { store: false },
  },
});
```

```tsx filename="AI SDK 5.0"
const result = await generateText({
  model: openai('gpt-4'),
  prompt: 'Hello',
  providerOptions: {
    openai: { store: false },
  },
});
```

**Codemod:** `replace-provider-metadata-with-provider-options`

### Message Structure Changes

#### UI Message Structure: Content → Parts Array

For `UIMessage`s, the `.content` property has been replaced with a `parts` array structure. However, `ModelMessage` still supports the `content` property.

```tsx filename="AI SDK 4.0"
import { type Message } from 'ai'; // v4 Message type

// UI Messages (useChat) - had content property
const uiMessage: Message = {
  id: '1',
  role: 'user',
  content: 'Bonjour!',
};

// Model Messages (generateText) - used content property
const result = await generateText({
  messages: [
    {
      role: 'user',
      content: 'Bonjour!',
    },
  ],
});
```

```tsx filename="AI SDK 5.0"
import { type UIMessage, type ModelMessage } from 'ai';

// UI Messages (useChat) - now use parts array
const uiMessage: UIMessage = {
  id: '1',
  role: 'user',
  parts: [{ type: 'text', text: 'Bonjour!' }],
};

// Model Messages (generateText) - content still supported
const modelMessages: ModelMessage[] = [
  {
    role: 'user',
    content: 'Bonjour!', // Still works with string
  },
];

// ModelMessage also supports parts array for complex content
const complexModelMessage: ModelMessage = {
  role: 'user',
  content: [
    { type: 'text', text: 'What do you see?' },
    { type: 'file', data: imageBuffer, mediaType: 'image/png' },
  ],
};
```

**Codemod:** `replace-content-with-parts`

#### Tool Handling: Invocations → Typed Tool Parts

Tool handling has been completely redesigned from generic tool invocations to typed tool parts with streaming states.

```tsx filename="AI SDK 4.0"
import { type Message } from 'ai';

// V4: Tool invocations were separate properties
{
  messages.map((message: Message) => (
    <>
      {message.toolInvocations?.map(toolInvocation => (
        <pre key={toolInvocation.toolCallId}>
          {toolInvocation.toolName}
          Args: {JSON.stringify(toolInvocation.args, null, 2)}
          Result: {toolInvocation.result}
        </pre>
      ))}
    </>
  ));
}
```

```tsx filename="AI SDK 5.0"
import { type UIMessage } from 'ai';

// V5: Tools are typed parts with specific naming: tool-${toolName}
{
  messages.map((message: UIMessage) => (
    <>
      {message.parts.map((part, index) => {
        switch (part.type) {
          case 'text':
            return <div key={index}>{part.text}</div>;

          case 'tool-getWeatherInformation': {
            switch (part.state) {
              case 'input-streaming':
                return (
                  <pre key={index}>{JSON.stringify(part.input, null, 2)}</pre>
                );
              case 'input-available':
                return (
                  <div key={index}>
                    Getting weather for {part.input.city}...
                  </div>
                );
              case 'output-available':
                return <div key={index}>Weather: {part.output}</div>;
            }
            break;
          }

          case 'tool-askForConfirmation': {
            switch (part.state) {
              case 'input-available':
                return (
                  <div key={index}>
                    {part.input.message}
                    <button
                      onClick={() =>
                        addToolResult({
                          toolCallId: part.toolCallId,
                          output: 'Yes, confirmed.',
                        })
                      }
                    >
                      Confirm
                    </button>
                  </div>
                );
              case 'output-available':
                return <div key={index}>Confirmed: {part.output}</div>;
            }
            break;
          }
        }
      })}
    </>
  ));
}
```

Key changes:

- **Type-safe naming**: `tool-${toolName}` instead of generic `tool-invocation`
- **Streaming states**: `input-streaming`, `input-available`, `output-available`
- **Property names**: `input`/`output` instead of `args`/`result`
- **Better client interaction**: Built-in support for user confirmation flows

#### Attachments → Parts

The `experimental_attachments` property has been replaced with the parts array.

```tsx filename="AI SDK 4.0"
{
  messages.map(message => (
    <div className="flex flex-col gap-2">
      {message.content}

      <div className="flex flex-row gap-2">
        {message.experimental_attachments?.map((attachment, index) =>
          attachment.contentType?.includes('image/') ? (
            <img src={attachment.url} alt={attachment.name} />
          ) : attachment.contentType?.includes('text/') ? (
            <div className="w-32 h-24 p-2 overflow-hidden text-xs border rounded-md ellipsis text-zinc-500">
              {getTextFromDataUrl(attachment.url)}
            </div>
          ) : null,
        )}
      </div>
    </div>
  ));
}
```

```tsx filename="AI SDK 5.0"
{
  messages.map(message => (
    <div>
      {message.parts.map((part, index) => {
        if (part.type === 'text') {
          return <div key={index}>{part.text}</div>;
        }

        if (part.type === 'file' && part.mediaType?.startsWith('image/')) {
          return (
            <div key={index}>
              <img src={part.url} />
            </div>
          );
        }
      })}
    </div>
  ));
}
```

**Codemod:** `replace-content-with-parts`

#### Tool Definition Changes (parameters → inputSchema)

Tool definitions have been updated to use `inputSchema` instead of `parameters` and error classes have been renamed.

```tsx filename="AI SDK 4.0"
import { tool, InvalidToolArgumentsError } from 'ai';

const weatherTool = tool({
  description: 'Get the weather for a city',
  parameters: z.object({
    city: z.string(),
  }),
  execute: async ({ city }) => {
    return `Weather in ${city}`;
  },
});

throw new InvalidToolArgumentsError({
  toolName: 'weather',
  arguments: invalidArgs,
});
```

```tsx filename="AI SDK 5.0"
import { tool, InvalidToolInputError } from 'ai';

const weatherTool = tool({
  description: 'Get the weather for a city',
  inputSchema: z.object({
    city: z.string(),
  }),
  execute: async ({ city }) => {
    return `Weather in ${city}`;
  },
});

throw new InvalidToolInputError({
  toolName: 'weather',
  input: invalidInput,
});
```

#### Media Type Standardization

`mimeType` has been renamed to `mediaType` for consistency.

```tsx filename="AI SDK 4.0"
const result = await streamText({
  model: openai('gpt-4-turbo'),
  messages: [
    {
      role: 'user',
      content: [
        {
          type: 'file',
          data: contents,
          mimeType: 'application/pdf',
        },
      ],
    },
  ],
});
```

```tsx filename="AI SDK 5.0"
const result = await streamText({
  model: openai('gpt-4-turbo'),
  messages: [
    {
      role: 'user',
      content: [
        {
          type: 'file',
          data: contents,
          mediaType: 'application/pdf',
        },
      ],
    },
  ],
});
```

**Codemod:** `rename-mime-type-to-media-type`

#### Image Type → File Type

The separate image type has been consolidated into the file type.

```tsx filename="AI SDK 4.0"
const result = await generateText({
  model: someModel,
  messages: [
    {
      role: 'user',
      content: [
        { type: 'text', text: 'What do you see?' },
        {
          type: 'image',
          image: new Uint8Array([0, 1, 2, 3]),
          mimeType: 'image/png',
        },
      ],
    },
  ],
});
```

```tsx filename="AI SDK 5.0"
const result = await generateText({
  model: someModel,
  messages: [
    {
      role: 'user',
      content: [
        { type: 'text', text: 'What do you see?' },
        {
          type: 'file',
          image: new Uint8Array([0, 1, 2, 3]),
          mimeType: 'image/png',
        },
      ],
    },
  ],
});
```

**Codemod:** `replace-image-type-with-file-type`

### Reasoning Support

#### Reasoning Text Property Rename

The `.reasoning` property has been renamed to `.reasoningText` for multi-step generations.

```tsx filename="AI SDK 4.0"
for (const step of steps) {
  console.log(step.reasoning);
}
```

```tsx filename="AI SDK 5.0"
for (const step of steps) {
  console.log(step.reasoningText);
}
```

**Codemod:** `rename-reasoning-to-reasoningText`

#### Generate Text Reasoning Property Changes

In `generateText()` and `streamText()` results, reasoning properties have been renamed.

```tsx filename="AI SDK 4.0"
const result = await generateText({
  model: anthropic('claude-3-5-sonnet-20241022'),
  prompt: 'Explain your reasoning',
});

console.log(result.reasoning); // String reasoning text
console.log(result.reasoningDetails); // Array of reasoning details
```

```tsx filename="AI SDK 5.0"
const result = await generateText({
  model: anthropic('claude-3-5-sonnet-20241022'),
  prompt: 'Explain your reasoning',
});

console.log(result.reasoningText); // String reasoning text
console.log(result.reasoning); // Array of reasoning details
```

**Codemod:** `rename-reasoning-properties`

#### UI Message Reasoning Structure

The reasoning property on UI messages has been moved to parts.

```tsx filename="AI SDK 4.0"
const message: UIMessage = {
  role: 'assistant',
  content: 'Hello',
  reasoning: 'I will greet the user',
};
```

```tsx filename="AI SDK 5.0"
const message: UIMessage = {
  role: 'assistant',
  parts: [
    {
      type: 'reasoning',
      text: 'I will greet the user',
    },
    {
      type: 'text',
      text: 'Hello',
    },
  ],
};
```

#### Reasoning Part Property Rename

The `reasoning` property on reasoning UI parts has been renamed to `text`.

```tsx filename="AI SDK 4.0"
{
  message.parts.map((part, index) => {
    if (part.type === 'reasoning') {
      return (
        <div key={index} className="reasoning-display">
          {part.reasoning}
        </div>
      );
    }
  });
}
```

```tsx filename="AI SDK 5.0"
{
  message.parts.map((part, index) => {
    if (part.type === 'reasoning') {
      return (
        <div key={index} className="reasoning-display">
          {part.text}
        </div>
      );
    }
  });
}
```

### Provider-Specific Changes

#### OpenAI

##### Structured Outputs Default

Structured outputs are now enabled by default for supported OpenAI models.

```tsx filename="AI SDK 4.0"
const result = await generateText({
  model: openai('gpt-4o-2024-08-06', { structuredOutputs: true }),
});
```

```tsx filename="AI SDK 5.0"
const result = await generateText({
  model: openai('gpt-4o-2024-08-06'),
  // structuredOutputs: true is now the default
});
```

##### Compatibility Option Removal

The `compatibility` option has been removed; strict mode is now the default.

```tsx filename="AI SDK 4.0"
const openai = createOpenAI({
  compatibility: 'strict',
});
```

```tsx filename="AI SDK 5.0"
const openai = createOpenAI({
  // strict compatibility is now the default
});
```

**Codemod:** `remove-openai-compatibility`

##### Legacy Function Calls Removal

The `useLegacyFunctionCalls` option has been removed.

```tsx filename="AI SDK 4.0"
const result = streamText({
  model: openai('gpt-4o', { useLegacyFunctionCalls: true }),
});
```

```tsx filename="AI SDK 5.0"
const result = streamText({
  model: openai('gpt-4o'),
});
```

#### Simulate Streaming Middleware

The `simulateStreaming` model option has been replaced with middleware.

```tsx filename="AI SDK 4.0"
const result = generateText({
  model: openai('gpt-4o', { simulateStreaming: true }),
  prompt: 'Hello, world!',
});
```

```tsx filename="AI SDK 5.0"
import { simulateStreamingMiddleware, wrapLanguageModel } from 'ai';

const model = wrapLanguageModel({
  model: openai('gpt-4o'),
  middleware: simulateStreamingMiddleware(),
});

const result = generateText({
  model,
  prompt: 'Hello, world!',
});
```

**Codemod:** `replace-simulate-streaming`

#### Amazon Bedrock

##### Snake Case → Camel Case

Provider options have been updated to use camelCase.

```tsx filename="AI SDK 4.0"
const result = await generateText({
  model: bedrock('amazon.titan-tg1-large'),
  prompt: 'Hello, world!',
  providerOptions: {
    bedrock: {
      reasoning_config: {
        /* ... */
      },
    },
  },
});
```

```tsx filename="AI SDK 5.0"
const result = await generateText({
  model: bedrock('amazon.titan-tg1-large'),
  prompt: 'Hello, world!',
  providerOptions: {
    bedrock: {
      reasoningConfig: {
        /* ... */
      },
    },
  },
});
```

**Codemod:** `replace-bedrock-snake-case`

### Embedding Changes

#### Provider Options for Embeddings

Embedding model settings now use provider options instead of model parameters.

```tsx filename="AI SDK 4.0"
const { embedding } = await embed({
  model: openai('text-embedding-3-small', {
    dimensions: 10,
  }),
});
```

```tsx filename="AI SDK 5.0"
const { embedding } = await embed({
  model: openai('text-embedding-3-small'),
  providerOptions: {
    openai: {
      dimensions: 10,
    },
  },
});
```

**Codemod:** `move-provider-options` (messages only due to complexity)

#### Raw Response → Response

The `rawResponse` property has been renamed to `response`.

```tsx filename="AI SDK 4.0"
const { rawResponse } = await embed(/* */);
```

```tsx filename="AI SDK 5.0"
const { response } = await embed(/* */);
```

**Codemod:** `replace-rawresponse-with-response`

#### Parallel Requests in embedMany

`embedMany` now makes parallel requests with a configurable `maxParallelCalls` option.

```tsx filename="AI SDK 5.0"
const { embeddings, usage } = await embedMany({
  maxParallelCalls: 2, // Limit parallel requests
  model: openai.embedding('text-embedding-3-small'),
  values: [
    'sunny day at the beach',
    'rainy afternoon in the city',
    'snowy night in the mountains',
  ],
});
```

### Streaming Changes

The streaming architecture has been completely redesigned in v5 to support better content differentiation, concurrent streaming of multiple parts, and improved real-time UX.

#### Stream Protocol: Single Chunks → Start/Delta/End Pattern

The fundamental streaming pattern has changed from single chunks to a three-phase pattern with unique IDs for each content block.

```tsx filename="AI SDK 4.0"
for await (const chunk of result.fullStream) {
  switch (chunk.type) {
    case 'text-delta': {
      process.stdout.write(chunk.textDelta);
      break;
    }
  }
}
```

```tsx filename="AI SDK 5.0"
for await (const chunk of result.fullStream) {
  switch (chunk.type) {
    case 'text-start': {
      // New: Initialize a text block with unique ID
      console.log(`Starting text block: ${chunk.id}`);
      break;
    }
    case 'text-delta': {
      // Changed: Now includes ID and uses 'delta' property
      process.stdout.write(chunk.delta); // Changed from 'textDelta'
      break;
    }
    case 'text-end': {
      // New: Finalize the text block
      console.log(`Completed text block: ${chunk.id}`);
      break;
    }
  }
}
```

This pattern enables:

- **Multiple concurrent content blocks**: Multiple text parts can stream simultaneously with different IDs
- **Better UI control**: You can track the lifecycle of each content block
- **Content block differentiation**: Distinguish between different parts of the same type

#### Reasoning Streaming Pattern

Reasoning content now follows the same start/delta/end pattern:

```tsx filename="AI SDK 4.0"
for await (const chunk of result.fullStream) {
  switch (chunk.type) {
    case 'reasoning': {
      // Single chunk with full reasoning text
      console.log('Reasoning:', chunk.text);
      break;
    }
  }
}
```

```tsx filename="AI SDK 5.0"
for await (const chunk of result.fullStream) {
  switch (chunk.type) {
    case 'reasoning-start': {
      console.log(`Starting reasoning block: ${chunk.id}`);
      break;
    }
    case 'reasoning-delta': {
      process.stdout.write(chunk.delta);
      break;
    }
    case 'reasoning-end': {
      console.log(`Completed reasoning block: ${chunk.id}`);
      break;
    }
  }
}
```

#### Tool Input Streaming

Tool inputs can now be streamed as they're being generated:

```tsx filename="AI SDK 5.0"
for await (const chunk of result.fullStream) {
  switch (chunk.type) {
    case 'tool-input-start': {
      console.log(`Starting tool input for ${chunk.toolName}: ${chunk.id}`);
      break;
    }
    case 'tool-input-delta': {
      // Stream the JSON input as it's being generated
      process.stdout.write(chunk.delta);
      break;
    }
    case 'tool-input-end': {
      console.log(`Completed tool input: ${chunk.id}`);
      break;
    }
    case 'tool-call': {
      // Final tool call with complete input
      console.log('Tool call:', chunk.toolName, chunk.input);
      break;
    }
  }
}
```

**Codemod:** `replace-textdelta-with-text`

#### onChunk Callback Changes

The `onChunk` callback now receives the new streaming chunk types with IDs and the start/delta/end pattern.

```tsx filename="AI SDK 4.0"
const result = streamText({
  model: openai('gpt-4o'),
  prompt: 'Write a story',
  onChunk({ chunk }) {
    switch (chunk.type) {
      case 'text-delta': {
        // Single property with text content
        console.log('Text delta:', chunk.textDelta);
        break;
      }
    }
  },
});
```

```tsx filename="AI SDK 5.0"
const result = streamText({
  model: openai('gpt-4o'),
  prompt: 'Write a story',
  onChunk({ chunk }) {
    switch (chunk.type) {
      case 'text-start': {
        // New: Track when a text block starts
        console.log('Text block started:', chunk.id);
        break;
      }
      case 'text-delta': {
        // Changed: Now uses 'delta' property and includes ID
        console.log(`Text delta for ${chunk.id}:`, chunk.delta);
        break;
      }
      case 'text-end': {
        // New: Track when a text block completes
        console.log('Text block completed:', chunk.id);
        break;
      }
      case 'reasoning-start': {
        console.log('Reasoning started:', chunk.id);
        break;
      }
      case 'reasoning-delta': {
        console.log(`Reasoning delta for ${chunk.id}:`, chunk.delta);
        break;
      }
      case 'reasoning-end': {
        console.log('Reasoning completed:', chunk.id);
        break;
      }
      case 'tool-input-start': {
        console.log(`Tool input started for ${chunk.toolName}:`, chunk.id);
        break;
      }
      case 'tool-input-delta': {
        console.log(`Tool input delta for ${chunk.id}:`, chunk.delta);
        break;
      }
      case 'tool-input-end': {
        console.log('Tool input completed:', chunk.id);
        break;
      }
    }
  },
});
```

This enables much more sophisticated real-time UX patterns, such as:

```tsx filename="AI SDK 5.0"
// Track multiple concurrent content blocks
const activeBlocks = new Map();

const result = streamText({
  model: openai('gpt-4o'),
  prompt: 'Write a story with reasoning',
  onChunk({ chunk }) {
    switch (chunk.type) {
      case 'text-start':
      case 'reasoning-start': {
        activeBlocks.set(chunk.id, { type: chunk.type, content: '' });
        break;
      }
      case 'text-delta':
      case 'reasoning-delta': {
        const block = activeBlocks.get(chunk.id);
        if (block) {
          block.content += chunk.delta;
          // Update UI for this specific block
          updateBlockInUI(chunk.id, block.content);
        }
        break;
      }
      case 'text-end':
      case 'reasoning-end': {
        const block = activeBlocks.get(chunk.id);
        if (block) {
          finalizeBlockInUI(chunk.id, block.content);
          activeBlocks.delete(chunk.id);
        }
        break;
      }
    }
  },
});
```

#### File Stream Parts Restructure

File parts in streams have been flattened.

```tsx filename="AI SDK 4.0"
for await (const chunk of result.fullStream) {
  switch (chunk.type) {
    case 'file': {
      console.log('Media type:', chunk.file.mediaType);
      console.log('File data:', chunk.file.data);
      break;
    }
  }
}
```

```tsx filename="AI SDK 5.0"
for await (const chunk of result.fullStream) {
  switch (chunk.type) {
    case 'file': {
      console.log('Media type:', chunk.mediaType);
      console.log('File data:', chunk.data);
      break;
    }
  }
}
```

**Codemod:** `flatten-streamtext-file-properties`

#### Source Stream Parts Restructure

Source stream parts have been flattened.

```tsx filename="AI SDK 4.0"
for await (const part of result.fullStream) {
  if (part.type === 'source' && part.source.sourceType === 'url') {
    console.log('ID:', part.source.id);
    console.log('Title:', part.source.title);
    console.log('URL:', part.source.url);
  }
}
```

```tsx filename="AI SDK 5.0"
for await (const part of result.fullStream) {
  if (part.type === 'source' && part.sourceType === 'url') {
    console.log('ID:', part.id);
    console.log('Title:', part.title);
    console.log('URL:', part.url);
  }
}
```

**Codemod:** `restructure-source-stream-parts`

### Data Streaming Changes

#### Stream Protocol v2

The data stream protocol has been updated to use Server-Sent Events.

```tsx filename="AI SDK 4.0"
import { createDataStream, formatDataStreamPart } from 'ai';

const dataStream = createDataStream({
  execute: writer => {
    writer.writeData('initialized call');
    writer.write(formatDataStreamPart('text', 'Hello'));
    writer.writeSource({
      type: 'source',
      sourceType: 'url',
      id: 'source-1',
      url: 'https://example.com',
      title: 'Example Source',
    });
  },
});
```

```tsx filename="AI SDK 5.0"
import { createUIMessageStream } from 'ai';

const stream = createUIMessageStream({
  execute: ({ writer }) => {
    writer.write({ type: 'data', value: ['initialized call'] });
    writer.write({ type: 'text', value: 'Hello' });
    writer.write({
      type: 'source-url', // TODO DOUBLE CHECK THIS
      value: {
        type: 'source',
        id: 'source-1',
        url: 'https://example.com',
        title: 'Example Source',
      },
    });
  },
});
```

**Codemod:** `migrate-to-data-stream-protocol-v2` // TODO: Gregor to confirm this has been updated to UIMessageStream

#### Streaming API Restructure

The streaming API has been completely restructured from data streams to UI message streams.

```tsx filename="AI SDK 4.0"
// Express/Node.js servers
app.post('/stream', async (req, res) => {
  const result = streamText({
    model: openai('gpt-4o'),
    prompt: 'Generate content',
  });

  result.pipeDataStreamToResponse(res);
});

// Next.js API routes
const result = streamText({
  model: openai('gpt-4o'),
  prompt: 'Generate content',
});

return result.toDataStreamResponse();
```

```tsx filename="AI SDK 5.0"
// Express/Node.js servers
app.post('/stream', async (req, res) => {
  const result = streamText({
    model: openai('gpt-4o'),
    prompt: 'Generate content',
  });

  result.pipeUIMessageStreamToResponse(res);
});

// Next.js API routes
const result = streamText({
  model: openai('gpt-4o'),
  prompt: 'Generate content',
});

return result.toUIMessageStreamResponse();
```

#### Stream Naming Changes

Various stream-related functions have been renamed for consistency.

```tsx filename="AI SDK 4.0"
import { DataStreamToSSETransformStream } from 'ai';
```

```tsx filename="AI SDK 5.0"
import { JsonToSseTransformStream } from 'ai';
```

**Codemod:** `rename-datastream-transform-stream`

#### UI Message Stream Changes

DataStream methods have been renamed to UIMessage methods.

```tsx filename="AI SDK 4.0"
const result = streamText({ model, prompt });
result.pipeDataStreamToResponse(res);
```

```tsx filename="AI SDK 5.0"
const result = streamText({ model, prompt });
result.pipeUIMessageStreamToResponse(res);
```

### Hook Changes

#### useChat Changes

##### Send Extra Message Fields Default

The `sendExtraMessageFields` option has been removed and is now the default behavior.

```tsx filename="AI SDK 4.0"
const { messages } = useChat({
  sendExtraMessageFields: true,
});
```

```tsx filename="AI SDK 5.0"
const { messages } = useChat({
  // sendExtraMessageFields is now the default
});
```

**Codemod:** `remove-sendExtraMessageFields`

##### Keep Last Message on Error Removal

The `keepLastMessageOnError` option has been removed as it's no longer needed.

```tsx filename="AI SDK 4.0"
const { messages } = useChat({
  keepLastMessageOnError: true,
});
```

```tsx filename="AI SDK 5.0"
const { messages } = useChat({
  // keepLastMessageOnError is no longer needed
});
```

##### Chat Request Options Changes

The `data` and `allowEmptySubmit` options have been removed from `ChatRequestOptions`.

```tsx filename="AI SDK 4.0"
handleSubmit(e, {
  data: { imageUrl: 'https://...' },
  body: { custom: 'value' },
});
```

```tsx filename="AI SDK 5.0"
sendMessage(
  {
    /* yourMessage */
  },
  {
    body: {
      custom: 'value',
      imageUrl: 'https://...', // Move data to body
    },
  },
);
```

##### Request Options Type Rename

`RequestOptions` has been renamed to `CompletionRequestOptions`.

```tsx filename="AI SDK 4.0"
import type { RequestOptions } from 'ai';
```

```tsx filename="AI SDK 5.0"
import type { CompletionRequestOptions } from 'ai';
```

**Codemod:** `rename-request-options`

##### Loading State Changes

The deprecated `isLoading` helper has been removed in favor of `status`.

```tsx filename="AI SDK 4.0"
const { isLoading } = useChat();
```

```tsx filename="AI SDK 5.0"
const { status } = useChat();
// Use state instead of isLoading for more granular control
```

##### Resume Stream Support

The resume functionality has been moved from `experimental_resume` to `resumeStream`.

```tsx filename="AI SDK 4.0"
// Resume was experimental
const { messages } = useChat({
  experimental_resume: true,
});
```

```tsx filename="AI SDK 5.0"
const { messages } = useChat({
  resumeStream: true, // Resume interrupted streams
});
```

#### useCompletion Changes

The `data` property has been removed from the `useCompletion` hook.

```tsx filename="AI SDK 4.0"
const {
  completion,
  handleSubmit,
  data, // No longer available
} = useCompletion();
```

```tsx filename="AI SDK 5.0"
const {
  completion,
  handleSubmit,
  // data property removed entirely
} = useCompletion();
```

#### useAssistant Removal

The `useAssistant` hook has been removed.

```tsx filename="AI SDK 4.0"
import { useAssistant } from '@ai-sdk/react';
```

```tsx filename="AI SDK 5.0"
// useAssistant has been removed
// Use useChat with appropriate configuration instead
```

// TODO: Add link to assitant api example @jeremy

### Utility Changes

#### ID Generation Changes

The `createIdGenerator()` function now requires a `size` argument.

```tsx filename="AI SDK 4.0"
const generator = createIdGenerator({ prefix: 'msg' });
const id = generator(16); // Custom size at call time
```

```tsx filename="AI SDK 5.0"
const generator = createIdGenerator({ prefix: 'msg', size: 16 });
const id = generator(); // Fixed size from creation
```

#### IDGenerator → IdGenerator

The type name has been updated.

```tsx filename="AI SDK 4.0"
import { IDGenerator } from 'ai';
```

```tsx filename="AI SDK 5.0"
import { IdGenerator } from 'ai';
```

### Provider Interface Changes

#### Language Model V2 Import

`LanguageModelV2` must now be imported from `@ai-sdk/provider`.

```tsx filename="AI SDK 4.0"
import { LanguageModelV2 } from 'ai';
```

```tsx filename="AI SDK 5.0"
import { LanguageModelV2 } from '@ai-sdk/provider';
```

**Codemod:** `import-LanguageModelV2-from-provider-package`

#### Middleware Rename

`LanguageModelV1Middleware` has been renamed and moved.

```tsx filename="AI SDK 4.0"
import { LanguageModelV1Middleware } from 'ai';
```

```tsx filename="AI SDK 5.0"
import { LanguageModelV2Middleware } from '@ai-sdk/provider';
```

**Codemod:** `import-LanguageModelV2-from-provider-package`

#### Usage Token Properties

Token usage properties have been renamed for consistency.

```tsx filename="AI SDK 4.0"
// In language model implementations
{
  usage: {
    promptTokens: 10,
    completionTokens: 20
  }
}
```

```tsx filename="AI SDK 5.0"
// In language model implementations
{
  usage: {
    inputTokens: 10,
    outputTokens: 20,
    totalTokens: 30 // Now required
  }
}
```

**Codemod:** `replace-usage-token-properties`

#### Stream Part Type Changes

The `LanguageModelV2StreamPart` type has been significantly expanded to support the new streaming architecture with start/delta/end patterns and IDs.

```tsx filename="AI SDK 4.0"
// V4: Simple stream parts
type LanguageModelV2StreamPart =
  | { type: 'text-delta'; textDelta: string }
  | { type: 'reasoning'; text: string }
  | { type: 'tool-call'; toolCallId: string; toolName: string; input: string };
```

```tsx filename="AI SDK 5.0"
// V5: Enhanced stream parts with IDs and lifecycle events
type LanguageModelV2StreamPart =
  // Text blocks with start/delta/end pattern
  | {
      type: 'text-start';
      id: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }
  | {
      type: 'text-delta';
      id: string;
      delta: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }
  | {
      type: 'text-end';
      id: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }

  // Reasoning blocks with start/delta/end pattern
  | {
      type: 'reasoning-start';
      id: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }
  | {
      type: 'reasoning-delta';
      id: string;
      delta: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }
  | {
      type: 'reasoning-end';
      id: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }

  // Tool input streaming
  | {
      type: 'tool-input-start';
      id: string;
      toolName: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }
  | {
      type: 'tool-input-delta';
      id: string;
      delta: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }
  | {
      type: 'tool-input-end';
      id: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }

  // Enhanced tool calls
  | {
      type: 'tool-call';
      toolCallId: string;
      toolName: string;
      input: string;
      providerMetadata?: SharedV2ProviderMetadata;
    }

  // Stream lifecycle events
  | { type: 'stream-start'; warnings: Array<LanguageModelV2CallWarning> }
  | {
      type: 'finish';
      usage: LanguageModelV2Usage;
      finishReason: LanguageModelV2FinishReason;
      providerMetadata?: SharedV2ProviderMetadata;
    };
```

This requires provider implementations to:

1. **Generate unique IDs** for each content block
2. **Emit start events** before beginning to stream content
3. **Stream deltas** with the associated ID
4. **Emit end events** when content blocks complete
5. **Handle concurrent content** by maintaining multiple active blocks

```tsx filename="AI SDK 5.0"
// Example provider implementation
async function* streamResponse(prompt: string) {
  const textId = generateId();
  const reasoningId = generateId();

  // Start both text and reasoning concurrently
  yield { type: 'text-start', id: textId };
  yield { type: 'reasoning-start', id: reasoningId };

  // Stream deltas for both blocks
  yield { type: 'reasoning-delta', id: reasoningId, delta: 'Let me think about this...' };
  yield { type: 'text-delta', id: textId, delta: 'Hello' };
  yield { type: 'reasoning-delta', id: reasoningId, delta: ' The user is greeting me.' };
  yield { type: 'text-delta', id: textId, delta: ', how can I help?' };

  // End both blocks
  yield { type: 'reasoning-end', id: reasoningId };
  yield { type: 'text-end', id: textId };

  yield { type: 'finish', usage: { ... }, finishReason: 'stop' };
}
```

#### Raw Response → Response

Provider response objects have been updated.

```tsx filename="AI SDK 4.0"
// In language model implementations
{
  rawResponse: {
    /* ... */
  }
}
```

```tsx filename="AI SDK 5.0"
// In language model implementations
{
  response: {
    /* ... */
  }
}
```

**Codemod:** `replace-rawresponse-with-response`

#### `wrapLanguageModel` now stable

```tsx filename="AI SDK 4.0"
import { experimental_wrapLanguageModel } from 'ai';
```

```tsx filename="AI SDK 5.0"
import { wrapLanguageModel } from 'ai';
```

**Codemod:** `remove-experimental-wrap-language-model`

#### `activeTools` No Longer Experimental

```tsx filename="AI SDK 4.0"
const result = await generateText({
  model: openai('gpt-4'),
  messages,
  tools: { weatherTool, locationTool },
  experimental_activeTools: ['weatherTool'],
});
```

```tsx filename="AI SDK 5.0"
const result = await generateText({
  model: openai('gpt-4'),
  messages,
  tools: { weatherTool, locationTool },
  activeTools: ['weatherTool'], // No longer experimental
});
```

#### `prepareStep` No Longer Experimental

The `experimental_prepareStep` option has been promoted and no longer requires the experimental prefix.

```tsx filename="AI SDK 4.0"
const result = await generateText({
  model: openai('gpt-4'),
  messages,
  tools: { weatherTool, locationTool },
  experimental_prepareStep: ({ steps, stepNumber, model }) => {
    console.log('Preparing step:', stepNumber);
    return {
      activeTools: ['weatherTool'],
      system: 'Be helpful and concise.',
    };
  },
});
```

```tsx filename="AI SDK 5.0"
const result = await generateText({
  model: openai('gpt-4'),
  messages,
  tools: { weatherTool, locationTool },
  prepareStep: ({ steps, stepNumber, model }) => {
    console.log('Preparing step:', stepNumber);
    return {
      activeTools: ['weatherTool'],
      system: 'Be helpful and concise.',
      toolChoice: 'auto', // Can also configure toolChoice, model, etc.
    };
  },
});
```

The `prepareStep` function receives `{ steps, stepNumber, model }` and can return:

- `model`: Different model for this step
- `activeTools`: Which tools to make available
- `toolChoice`: Tool selection strategy
- `system`: System message for this step
- `undefined`: Use default settings

### Temperature Default Removal

Temperature is no longer set to `0` by default.

```tsx filename="AI SDK 4.0"
await generateText({
  model: openai('gpt-4'),
  prompt: 'Write a creative story',
  // Implicitly temperature: 0
});
```

```tsx filename="AI SDK 5.0"
await generateText({
  model: openai('gpt-4'),
  prompt: 'Write a creative story',
  temperature: 0, // Must explicitly set
});
```

### Callback Changes

#### onResponse Removal

The `onResponse` callback has been removed from `useChat` and `useCompletion`.

```tsx filename="AI SDK 4.0"
const { messages } = useChat({
  onResponse(response) {
    // handle response
  },
});
```

```tsx filename="AI SDK 5.0"
const { messages } = useChat({
  // onResponse is no longer available
});
```

### Tool System Overhaul

The tool system has been completely redesigned for better type safety, streaming support, and client interaction.

#### Tool Part Types and Naming

In v5, UI tool parts use typed naming: `tool-${toolName}` instead of generic types.

```tsx filename="AI SDK 4.0"
// V4: Generic tool-invocation type
{
  message.parts.map(part => {
    if (part.type === 'tool-invocation') {
      return <div>{part.toolInvocation.toolName}</div>;
    }
  });
}
```

```tsx filename="AI SDK 5.0"
// V5: Type-safe tool parts with specific names
{
  message.parts.map(part => {
    switch (part.type) {
      case 'tool-getWeatherInformation':
        return <div>Getting weather...</div>;
      case 'tool-askForConfirmation':
        return <div>Asking for confirmation...</div>;
    }
  });
}
```

#### Tool Property Changes (args/result → input/output)

Tool call and result properties have been renamed for better consistency with schemas.

```tsx filename="AI SDK 4.0"
// Tool calls used "args" and "result"
for await (const part of result.fullStream) {
  switch (part.type) {
    case 'tool-call':
      console.log('Tool args:', part.args);
      break;
    case 'tool-result':
      console.log('Tool result:', part.result);
      break;
  }
}
```

```tsx filename="AI SDK 5.0"
// Tool calls now use "input" and "output"
for await (const part of result.fullStream) {
  switch (part.type) {
    case 'tool-call':
      console.log('Tool input:', part.input);
      break;
    case 'tool-result':
      console.log('Tool output:', part.output);
      break;
  }
}
```

#### Tool States and Streaming

V5 introduces multiple tool states for better UX during tool execution.

```tsx filename="AI SDK 4.0"
// V4: Simple binary state (invoked or completed)
{
  toolInvocation.result ? (
    <div>Result: {toolInvocation.result}</div>
  ) : (
    <div>Tool executing...</div>
  );
}
```

```tsx filename="AI SDK 5.0"
// V5: Granular states with streaming support
{
  part.type === 'tool-getWeatherInformation' && (
    <>
      {part.state === 'input-streaming' && (
        <pre>Streaming input: {JSON.stringify(part.input, null, 2)}</pre>
      )}
      {part.state === 'input-available' && (
        <div>Getting weather for {part.input.city}...</div>
      )}
      {part.state === 'output-available' && <div>Weather: {part.output}</div>}
    </>
  );
}
```

This change aligns with `inputSchema` and `outputSchema` from MCP tools and provides better consistency.

#### Type Safety for Tools

To get full type safety and auto-completion for the new tool parts, you need to define your own message type that includes your tool definitions.

```tsx filename="AI SDK 4.0"
import { type Message } from 'ai';

// V4: Basic Message type without tool typing
const { messages } = useChat();

// No type safety for tool properties
{
  messages.map(message =>
    message.toolInvocations?.map(tool => (
      <div>{tool.toolName}</div> // No auto-completion
    )),
  );
}
```

```tsx filename="AI SDK 5.0"
import { type UIMessage, type UIDataTypes } from 'ai';

// Step 1: Define your custom message type with tool definitions
export type MyUIMessage = UIMessage<
  never, // Message metadata type (use `never` if not needed)
  UIDataTypes, // Data parts type (usually just UIDataTypes)
  {
    // Define your tools with input/output types
    getWeatherInformation: {
      input: { city: string };
      output: string;
    };
    askForConfirmation: {
      input: { message: string };
      output: string;
    };
  }
>;

// Step 2: Use your custom type in useChat
const { messages } = useChat<MyUIMessage>({
  // ... configuration
});

// Step 3: Get full type safety and auto-completion
{
  messages.map(message =>
    message.parts.map(part => {
      switch (part.type) {
        case 'tool-getWeatherInformation': {
          // Full type safety - TypeScript knows about input.city and output
          switch (part.state) {
            case 'input-available':
              return <div>Getting weather for {part.input.city}</div>;
            case 'output-available':
              return <div>Weather: {part.output}</div>;
          }
        }
      }
    }),
  );
}
```

### Step Control: maxSteps → stopWhen

The `maxSteps` parameter has been replaced with `stopWhen`, which provides more flexible control over multi-step execution.

```tsx filename="AI SDK 4.0"
// V4: Simple numeric limit
const result = await generateText({
  model: openai('gpt-4'),
  messages,
  maxSteps: 5, // Stop after exactly 5 steps
});

// useChat with maxSteps
const { messages } = useChat({
  maxSteps: 3, // Stop after 3 steps
});
```

```tsx filename="AI SDK 5.0"
import { stepCountIs, hasToolCall } from 'ai';

// V5: Function-based stopping conditions
const result = await generateText({
  model: openai('gpt-4'),
  messages,
  stopWhen: stepCountIs(5), // Stop when step count reaches 5
});

// Custom stopping condition
const result = await generateText({
  model: openai('gpt-4'),
  messages,
  stopWhen: ({ steps }) => {
    // Stop if we have 5 steps OR if the last step has no tool calls
    const lastStep = steps[steps.length - 1];
    return steps.length >= 5 || lastStep?.toolCalls?.length === 0;
  },
});

// Built-in helper functions
const result = await generateText({
  model: openai('gpt-4'),
  messages,
  stopWhen: hasToolCall('finalizeTask'), // Stop when specific tool is called
});

// useChat with stopWhen
const { messages } = useChat({
  api: '/api/chat',
  // stopWhen is configured on the server side in the API route
});
```

**Common stopping patterns:**

```tsx filename="AI SDK 5.0"
// Stop after N steps (equivalent to old maxSteps)
stopWhen: stepCountIs(5);

// Stop when specific tool is called
stopWhen: hasToolCall('finalizeTask');

// Stop based on step content
stopWhen: ({ steps }) => {
  const lastStep = steps[steps.length - 1];
  return lastStep?.text?.includes('DONE') || steps.length >= 10;
};

// Complex conditions
stopWhen: ({ steps }) =>
  steps.length >= 10 ||
  steps.some(step =>
    step.toolCalls?.some(call => call.toolName === 'finalizeTask'),
  ) ||
  steps[steps.length - 1]?.toolCalls?.length === 0;
```

### Continuation Steps Removal

The `experimental_continueSteps` option has been removed from `generateText()`.

```tsx filename="AI SDK 4.0"
const result = await generateText({
  experimental_continueSteps: true,
  // ...
});
```

```tsx filename="AI SDK 5.0"
// experimental_continueSteps has been removed
// Use newer models with higher output token limits instead
```

### Image Generation Changes

Image model settings have been moved to `providerOptions`.

```tsx filename="AI SDK 4.0"
await generateImage({
  model: luma.image('photon-flash-1', {
    maxImagesPerCall: 5,
    pollIntervalMillis: 500,
  }),
  prompt,
  n: 10,
});
```

```tsx filename="AI SDK 5.0"
await generateImage({
  model: luma.image('photon-flash-1'),
  prompt,
  n: 10,
  maxImagesPerCall: 5,
  providerOptions: {
    luma: { pollIntervalMillis: 500 },
  },
});
```

**Codemod:** `move-image-model-maxImagesPerCall`

### Step Result Changes

#### Step Type Removal

The `stepType` property has been removed from step results.

```tsx filename="AI SDK 4.0"
steps.forEach(step => {
  switch (step.stepType) {
    case 'initial':
      console.log('Initial step');
      break;
    case 'tool-result':
      console.log('Tool result step');
      break;
    case 'done':
      console.log('Final step');
      break;
  }
});
```

```tsx filename="AI SDK 5.0"
steps.forEach((step, index) => {
  if (index === 0) {
    console.log('Initial step');
  } else if (step.toolResults.length > 0) {
    console.log('Tool result step');
  } else {
    console.log('Final step');
  }
});
```

#### Usage vs Total Usage

Usage properties now distinguish between single step and total usage.

```tsx filename="AI SDK 4.0"
// usage contained total token usage across all steps
console.log(result.usage);
```

```tsx filename="AI SDK 5.0"
// usage contains token usage from the final step only
console.log(result.usage);
// totalUsage contains total token usage across all steps
console.log(result.totalUsage);
```

### Stream Event Changes

Stream event types have been renamed for consistency.

```tsx filename="AI SDK 4.0"
for await (const part of result.fullStream) {
  switch (part.type) {
    case 'step-finish': {
      console.log('Step finished:', part.finishReason);
      break;
    }
    case 'finish': {
      console.log('Usage:', part.usage);
      break;
    }
  }
}
```

```tsx filename="AI SDK 5.0"
for await (const part of result.fullStream) {
  switch (part.type) {
    case 'finish-step': {
      // Renamed from 'step-finish'
      console.log('Step finished:', part.finishReason);
      break;
    }
    case 'finish': {
      console.log('Total Usage:', part.totalUsage); // Changed from 'usage'
      break;
    }
  }
}
```

### UI Message Role Changes

The `data` role has been removed from UI messages.

```tsx filename="AI SDK 4.0"
const message = {
  role: 'data',
  content: 'Some content',
  data: { customField: 'value' },
};
```

```tsx filename="AI SDK 5.0"
// V5: Use UI message streams with custom data parts
const stream = createUIMessageStream({
  execute({ writer }) {
    // Write custom data instead of message annotations
    writer.write({
      type: 'data-custom',
      id: 'custom-1',
      data: { customField: 'value' },
    });
  },
});
```

### File Part Changes

File parts now use `.url` instead of `.data` and `.mimeType`.

```tsx filename="AI SDK 4.0"
{
  messages.map(message => (
    <div key={message.id}>
      {message.parts.map((part, index) => {
        if (part.type === 'text') {
          return <div key={index}>{part.text}</div>;
        } else if (part.type === 'file' && part.mimeType.startsWith('image/')) {
          return (
            <img
              key={index}
              src={`data:${part.mimeType};base64,${part.data}`}
            />
          );
        }
      })}
    </div>
  ));
}
```

```tsx filename="AI SDK 5.0"
{
  messages.map(message => (
    <div key={message.id}>
      {message.parts.map((part, index) => {
        if (part.type === 'text') {
          return <div key={index}>{part.text}</div>;
        } else if (part.type === 'file' && part.mimeType.startsWith('image/')) {
          return <img key={index} src={part.url} />;
        }
      })}
    </div>
  ));
}
```

### Provider-Utils Changes

Deprecated `CoreTool*` types have been removed.

```tsx filename="AI SDK 4.0"
import {
  CoreToolCall,
  CoreToolResult,
  CoreToolResultUnion,
  CoreToolCallUnion,
  CoreToolChoice,
} from '@ai-sdk/provider-utils';
```

```tsx filename="AI SDK 5.0"
import {
  ToolCall,
  ToolResult,
  ResultUnion,
  ToolCallUnion,
  ToolChoice,
} from '@ai-sdk/provider-utils';
```

### Stream Data Removal

The `StreamData` class has been completely removed and replaced with UI message streams for custom data.

```tsx filename="AI SDK 4.0"
import { StreamData } from 'ai';

const streamData = new StreamData();
streamData.append('custom-data');
streamData.close();
```

```tsx filename="AI SDK 5.0"
import { createUIMessageStream, createUIMessageStreamResponse } from 'ai';

const stream = createUIMessageStream({
  execute({ writer }) {
    // Write custom data parts
    writer.write({
      type: 'data-custom',
      id: 'custom-1',
      data: 'custom-data',
    });

    // Can merge with LLM streams
    const result = streamText({
      model: openai('gpt-4o'),
      messages,
    });

    writer.merge(result.toUIMessageStream());
  },
});

return createUIMessageStreamResponse({ stream });
```

## New Features in v5

While the sections above focus on breaking changes and migrations, AI SDK v5 also introduces several new features that enhance functionality without requiring code changes.

### Tool Output Schema

Tools can now optionally specify an output schema for better type inference and validation:

```tsx filename="AI SDK 5.0"
import { tool } from 'ai';
import { z } from 'zod';

const weatherTool = tool({
  description: 'Get weather information',
  inputSchema: z.object({
    city: z.string(),
  }),
  outputSchema: z.object({
    temperature: z.number(),
    conditions: z.string(),
  }),
  execute: async ({ city }) => ({
    temperature: 72,
    conditions: 'sunny',
  }),
});
```

This enables:

- **Better type inference** for tool outputs
- **Server-side tools** without execute functions
- **Validation** of tool outputs

### Tool Type Inference Helpers

New utility types simplify working with tool types:

```tsx filename="AI SDK 5.0"
import { InferToolInput, InferToolOutput, InferUITool } from 'ai';

// Infer input and output types from tool definitions
type WeatherInput = InferToolInput<typeof weatherTool>;
type WeatherOutput = InferToolOutput<typeof weatherTool>;
type WeatherUITool = InferUITool<typeof weatherTool>;

// Use in UI message type definitions
type MyUIMessage = UIMessage<
  never,
  UIDataTypes,
  {
    weather: WeatherUITool;
  }
>;
```

### OpenAI Provider-Defined Tools

New built-in tools for OpenAI:

```tsx filename="AI SDK 5.0"
import { openai } from '@ai-sdk/openai';

const result = await generateText({
  model: openai('gpt-4o'),
  tools: {
    file_search: openai.tools.fileSearch(),
    web_search_preview: openai.tools.webSearchPreview({
      searchContextSize: 'high',
    }),
  },
  messages,
});
```

Available tools:

- **`fileSearch`**: Search through uploaded documents using OpenAI's file search
- **`webSearchPreview`**: Web search capabilities (preview feature)

### Enhanced Tool Streaming

Tools now support fine-grained streaming callbacks:

```tsx filename="AI SDK 5.0"
const weatherTool = tool({
  inputSchema: z.object({ city: z.string() }),
  onInputStart: ({ toolCallId }) => {
    console.log('Tool input streaming started:', toolCallId);
  },
  onInputDelta: ({ inputTextDelta, toolCallId }) => {
    console.log('Tool input delta:', inputTextDelta);
  },
  onInputAvailable: ({ input, toolCallId }) => {
    console.log('Tool input ready:', input);
  },
  execute: async ({ city }) => {
    return `Weather in ${city}: sunny, 72°F`;
  },
});
```

## Codemod Table

| Change                                                          | Codemod                                           |
| --------------------------------------------------------------- | ------------------------------------------------- |
| **Package Structure Changes**                                   |                                                   |
| `@ai-sdk/rsc` Package Extraction                                | `rsc-package`                                     |
| React UI Hooks Moved to `@ai-sdk/react`                         | `move-react-to-ai-sdk`                            |
| `@ai-sdk/ui-utils` Package Removal                              | `move-ui-utils-to-ai`                             |
| LangChain Adapter Moved                                         | `move-langchain-adapter`                          |
| LlamaIndex Adapter Moved                                        | `replace-llamaindex-adapter`                      |
| **Core API Changes**                                            |                                                   |
| Maximum Output Tokens                                           | `rename-max-tokens-to-max-output-tokens`          |
| `CoreMessage` → `ModelMessage`                                  | `rename-core-message-to-model-message`            |
| `Message` → `UIMessage`                                         | `rename-message-to-ui-message`                    |
| Provider Metadata → Provider Options                            | `replace-provider-metadata-with-provider-options` |
| Content → Parts Array                                           | `replace-content-with-parts`                      |
| Attachments → Parts                                             | `replace-content-with-parts`                      |
| Media Type Standardization                                      | `rename-mime-type-to-media-type`                  |
| Image Type → File Type                                          | `replace-image-type-with-file-type`               |
| Step Control (maxSteps → stopWhen)                              | _N/A_ (API change)                                |
| **Reasoning Support**                                           |                                                   |
| Reasoning Text Property Rename                                  | `rename-reasoning-to-reasoningText`               |
| Generate Text Reasoning Properties                              | `rename-reasoning-properties`                     |
| **Provider-Specific Changes**                                   |                                                   |
| OpenAI Compatibility Option Removal                             | `remove-openai-compatibility`                     |
| Simulate Streaming Middleware                                   | `replace-simulate-streaming`                      |
| Amazon Bedrock Snake Case → Camel Case                          | `replace-bedrock-snake-case`                      |
| **Embedding Changes**                                           |                                                   |
| Provider Options for Embeddings                                 | `move-provider-options` (messages only)           |
| Raw Response → Response                                         | `replace-rawresponse-with-response`               |
| **Streaming Changes**                                           |                                                   |
| Stream Protocol: Single Chunks → Start/Delta/End Pattern        | `migrate-streaming-to-start-delta-end`            |
| Text Delta Properties (`textDelta` → `delta`)                   | `replace-textdelta-with-text`                     |
| onChunk Callback with New Stream Types                          | _N/A_ (handled by TypeScript)                     |
| Reasoning Streaming Pattern                                     | _N/A_ (new feature)                               |
| Tool Input Streaming                                            | _N/A_ (new feature)                               |
| Generate Text Result Structure                                  | `replace-generatetext-text-property`              |
| File Stream Parts Restructure                                   | `flatten-streamtext-file-properties`              |
| Source Stream Parts Restructure                                 | `restructure-source-stream-parts`                 |
| **Data Streaming Changes**                                      |                                                   |
| Stream Protocol v2                                              | `migrate-to-data-stream-protocol-v2`              |
| Stream Naming Changes                                           | `rename-datastream-transform-stream`              |
| **Hook Changes**                                                |                                                   |
| Send Extra Message Fields Default                               | `remove-sendExtraMessageFields`                   |
| Request Options Type Rename                                     | `rename-request-options`                          |
| Resume Stream Support                                           | _N/A_ (handled by TypeScript)                     |
| **Utility Changes**                                             |                                                   |
| Get UI Text Removal                                             | `remove-get-ui-text`                              |
| **Provider Interface Changes**                                  |                                                   |
| Language Model V2 Import                                        | `import-LanguageModelV2-from-provider-package`    |
| Middleware Rename                                               | `import-LanguageModelV2-from-provider-package`    |
| Stream Part Type Changes (LanguageModelV2StreamPart)            | _N/A_ (provider implementation change)            |
| Usage Token Properties                                          | `replace-usage-token-properties`                  |
| Raw Response → Response                                         | `replace-rawresponse-with-response`               |
| Experimental Wrappers Removal                                   | `remove-experimental-wrap-language-model`         |
| Active Tools No Longer Experimental                             | _N/A_ (handled by TypeScript)                     |
| Prepare Step No Longer Experimental                             | _N/A_ (handled by TypeScript)                     |
| **Callback Changes**                                            |                                                   |
| onCompletion → onFinal                                          | `replace-oncompletion-with-onfinal`               |
| **Tool Changes**                                                |                                                   |
| Tool Part Types and Naming (tool-invocation → tool-${toolName}) | _N/A_ (handled by TypeScript)                     |
| Tool Property Changes (args/result → input/output)              | _N/A_ (handled by TypeScript)                     |
| Tool States and Streaming                                       | _N/A_ (new feature)                               |
| Type Safety for Tools                                           | _N/A_ (requires custom type definition)           |
| **Image Generation Changes**                                    |                                                   |
| Image Model Settings                                            | `move-image-model-maxImagesPerCall`               |

<Note>
  Codemods marked as "messages only" provide warnings about complex changes that
  need manual intervention. Changes marked as "N/A" either don't require
  codemods (handled by TypeScript) or are too complex for automated migration.
</Note>
