---
title: createAgentUIStreamResponse
description: API Reference for the createAgentUIStreamResponse utility.
---

# `createAgentUIStreamResponse`

The `createAgentUIStreamResponse` function executes an [Agent](/docs/reference/ai-sdk-core/agent) and streams its output as a UI message stream in an HTTP [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response) body. This is useful for building API endpoints that deliver real-time streaming results from an agent (such as for chat or tool-use applications).

## Import

<Snippet
  text={`import { createAgentUIStreamResponse } from "ai"`}
  prompt={false}
/>

## Usage

```ts
import { ToolLoopAgent, createAgentUIStreamResponse } from 'ai';

const agent = new ToolLoopAgent({
  model: 'openai/gpt-4o',
  system: 'You are a helpful assistant.',
  tools: { weather: weatherTool, calculator: calculatorTool },
});

export async function POST(request: Request) {
  const { messages } = await request.json();

  // Stream agent response as an HTTP Response with UI messages
  return createAgentUIStreamResponse({
    agent,
    messages,
    // ...other optional streaming options
  });
}
```

## Parameters

<PropertiesTable
  content={[
    {
      name: 'agent',
      type: 'Agent',
      isRequired: true,
      description:
        'The agent instance to use for streaming responses. Must implement `.stream({ prompt })` and define tools.',
    },
    {
      name: 'messages',
      type: 'unknown[]',
      isRequired: true,
      description:
        'Array of input UI messages sent to the agent (typically user and assistant message objects).',
    },
    {
      name: '...options',
      type: 'UIMessageStreamOptions',
      isRequired: false,
      description:
        'Additional options for customizing UI message streaming. For example, controlling source inclusion or stream behavior.',
    },
  ]}
/>

## Returns

A `Promise<Response>` whose body is a stream of UI messages from the agent&mdash;suitable as an HTTP response in server-side API routes (Next.js, Express, serverless, or edge handlers).

## Example: Next.js API Route Handler

```ts
import { createAgentUIStreamResponse } from 'ai';
import { MyCustomAgent } from '@/agent/my-custom-agent';

export async function POST(request: Request) {
  const { messages } = await request.json();

  return createAgentUIStreamResponse({
    agent: MyCustomAgent,
    messages,
    sendSources: true, // optionally include sources in the UI message stream
  });
}
```

## How It Works

1. **Message Validation:** The function validates and normalizes the incoming `messages` according to the agent's tools. Invalid messages will result in an error.
2. **Conversion:** Validated messages are converted into the internal model message format required by the agent.
3. **Streaming:** The agent's `.stream({ prompt })` method is invoked, producing a stream of UI messages representing the agent's thinking and output.
4. **Response:** The message stream is returned as a readable HTTP `Response` suitable for consumption by clients (such as a chat UI or live tool interface).

## Notes

- The agent must define tools and conform to streaming requirements.
- Use this function for backend/server/API code, **not from the browser**.
- Additional options can control UI message streaming (see [`UIMessageStreamOptions`](/docs/reference/ai-sdk-core/ui-message-stream-options)).
- The returned `Response` uses readable streams; ensure the client supports streaming consumption.

## See Also

- [`Agent`](/docs/reference/ai-sdk-core/agent)
- [`ToolLoopAgent`](/docs/reference/ai-sdk-core/tool-loop-agent)
- [`UIMessage`](/docs/reference/ai-sdk-core/ui-message)
- [`UIMessageStreamOptions`](/docs/reference/ai-sdk-core/ui-message-stream-options)
