---
title: createAgentStreamResponse
description: API Reference for the createAgentStreamResponse utility.
---

# `createAgentStreamResponse`

The `createAgentStreamResponse` function executes an [Agent](/docs/reference/ai-sdk-core/agent) and streams its output as a UI message stream in an HTTP [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response) body. This is useful for creating API endpoints that deliver real-time streaming results from an agent (such as in chat or tool-using applications).

## Import

<Snippet
  text={`import { createAgentStreamResponse } from "ai"`}
  prompt={false}
/>

## Usage

```ts
import { ToolLoopAgent, createAgentStreamResponse } from 'ai';

const agent = new ToolLoopAgent({
  model: 'openai/gpt-4o',
  system: 'You are a helpful assistant.',
  tools: { weather: weatherTool, calculator: calculatorTool },
});

export async function POST(request: Request) {
  const { messages } = await request.json();

  // Stream agent response as an HTTP Response with UI messages
  return createAgentStreamResponse({
    agent,
    messages,
    // ...other optional streaming options
  });
}
```

## Parameters

<PropertiesTable
  content={[
    {
      name: 'agent',
      type: 'Agent',
      isRequired: true,
      description:
        'The agent instance to use for streaming responses. Must implement `.stream({ prompt })` and define tools.',
    },
    {
      name: 'messages',
      type: 'unknown[]',
      isRequired: true,
      description:
        'Array of input UI messages sent to the agent (typically user and assistant message objects).',
    },
    {
      name: '...options',
      type: 'UIMessageStreamOptions',
      isRequired: false,
      description:
        'Additional options for customizing UI message streaming, such as including sources.',
    },
  ]}
/>

## Returns

A `Promise<Response>` whose body is a stream of UI messages from the agentâ€”this is suitable as the HTTP response in server-side API routes (such as in Next.js, Express, serverless, or edge handlers).

## Example: Next.js API Route Handler

```ts
import { createAgentStreamResponse } from 'ai';
import { MyCustomAgent } from '@/agent/my-custom-agent';

export async function POST(request: Request) {
  const { messages } = await request.json();

  return createAgentStreamResponse({
    agent: MyCustomAgent,
    messages,
    sendSources: true, // optionally include sources in the UI message stream
  });
}
```

## How It Works

1. **Message Validation:** The function validates and normalizes the incoming `messages` according to the agent's tools. Invalid messages will cause an error.
2. **Conversion:** Validated messages are converted to the internal model message format expected by the agent.
3. **Streaming:** The agent's `.stream({ prompt })` method is invoked, returning a stream of UI messages based on the prompt and agent logic.
4. **Response:** The message stream is returned as a readable HTTP `Response` that can be handled on the client (for example, to drive a chat UI or a real-time tool UI).

## Notes

- The agent should define tools and conform to streaming requirements.
- This function is intended for backend (API) code, not for use in the browser/client.
- Additional options may be passed to control aspects of UI message streaming (see [`UIMessageStreamOptions`](/docs/reference/ai-sdk-core/ui-message-stream-options)).
- The returned `Response` uses readable streams, which require compatible client support for streaming consumption.

## See Also

- [`Agent`](/docs/reference/ai-sdk-core/agent)
- [`ToolLoopAgent`](/docs/reference/ai-sdk-core/tool-loop-agent)
- [`UIMessage`](/docs/reference/ai-sdk-core/ui-message)
- [`UIMessageStreamOptions`](/docs/reference/ai-sdk-core/ui-message-stream-options)
