---
title: createAgentStreamResponse
description: API Reference for createAgentStreamResponse utility.
---

# `createAgentStreamResponse`

The `createAgentStreamResponse` function runs an Agent and streams its output as a UI message stream in the response body. This utility is designed for building server endpoints that interface with agents, enabling real-time streaming of agent responses over HTTP.

## Import

<Snippet
  text={`import { createAgentStreamResponse } from "ai"`}
  prompt={false}
/>

## Usage

```ts
import { createAgentStreamResponse, ToolLoopAgent } from 'ai';

const agent = new ToolLoopAgent({
  model: 'openai/gpt-4o',
  system: 'You are a helpful assistant.',
  tools: {
    weather: weatherTool,
    calculator: calculatorTool,
  },
});

export async function POST(req: Request) {
  const { messages } = await req.json();

  // Return agent output as a UI message stream HTTP response
  return createAgentStreamResponse({
    agent,
    messages,
  });
}
```

## Parameters

<PropertiesTable
  content={[
    {
      name: 'agent',
      type: 'Agent',
      isRequired: true,
      description: 'The agent instance to use for streaming responses.',
    },
    {
      name: 'messages',
      type: 'unknown[]',
      isRequired: true,
      description: 'An array of input UI messages for the agent.',
    },
  ]}
/>

## Returns

A `Promise<Response>` containing a stream of UI messages from the agent, suitable as a response body in HTTP APIs (for example, in Next.js API routes or serverless functions).

## Example: Next.js Route Handler

```ts
import { ToolLoopAgent, createAgentStreamResponse } from 'ai';

const agent = new ToolLoopAgent({
  model: 'openai/gpt-4o',
  system: 'You are a helpful assistant.',
  tools: {
    weather: weatherTool,
  },
});

export async function POST(req: Request) {
  const { messages } = await req.json();
  return await createAgentStreamResponse({
    agent,
    messages,
  });
}
```

## How It Works

- **Message Validation:** The input `messages` array is validated and normalized into UI message objects.
- **Agent Streaming:** The agentâ€™s `.stream` method is called using the validated messages and configuration.
- **UI Message Stream:** The streamed results are returned as a readable HTTP response, ready to be consumed on the client (for example, to drive chat UIs).

## Notes

- The agent must use tools and be compatible with streaming responses.
- This utility is typically used in backend/server handlers (e.g., API routes, edge/serverless functions).
- The return value is a [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response) object; to use streams on the frontend, client support is required.

## See Also

- [`ToolLoopAgent`](/docs/reference/ai-sdk-core/tool-loop-agent)
- [`UIMessage`](/docs/reference/ai-sdk-core/ui-message)
- [`InferAgentUIMessage`](/docs/reference/ai-sdk-core/tool-loop-agent#inferagentuimessage)
