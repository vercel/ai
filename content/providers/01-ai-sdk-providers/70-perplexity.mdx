---
title: Perplexity
description: Learn how to use Perplexity's Sonar API with the AI SDK.
---

# Perplexity Provider

The [Perplexity](https://sonar.perplexity.ai) provider gives you access to both the Sonar and Search APIs. The Sonar API provides grounded language models that deliver responses enhanced by real-time web search with comprehensive citations, making them ideal for research, fact-checking, and staying current with the latest information. The Search API provides direct access to ranked search results, allowing you to augment any model that supports tool calling with real-time web data.

API keys can be obtained from the [Perplexity Platform](https://docs.perplexity.ai).

## Setup

The Perplexity provider is available via the `@ai-sdk/perplexity` module. You can install it with:

<Tabs items={['pnpm', 'npm', 'yarn', 'bun']}>
  <Tab>
    <Snippet text="pnpm add @ai-sdk/perplexity" dark />
  </Tab>
  <Tab>
    <Snippet text="npm install @ai-sdk/perplexity" dark />
  </Tab>
  <Tab>
    <Snippet text="yarn add @ai-sdk/perplexity" dark />
  </Tab>

  <Tab>
    <Snippet text="bun add @ai-sdk/perplexity" dark />
  </Tab>
</Tabs>

## Provider Instance

You can import the default provider instance `perplexity` from `@ai-sdk/perplexity`:

```ts
import { perplexity } from '@ai-sdk/perplexity';
```

For custom configuration, you can import `createPerplexity` and create a provider instance with your settings:

```ts
import { createPerplexity } from '@ai-sdk/perplexity';

const perplexity = createPerplexity({
  apiKey: process.env.PERPLEXITY_API_KEY ?? '',
});
```

You can use the following optional settings to customize the Perplexity provider instance:

- **baseURL** _string_

  Use a different URL prefix for API calls.
  The default prefix is `https://api.perplexity.ai`.

- **apiKey** _string_

  API key that is being sent using the `Authorization` header. It defaults to
  the `PERPLEXITY_API_KEY` environment variable.

- **headers** _Record&lt;string,string&gt;_

  Custom headers to include in the requests.

- **fetch** _(input: RequestInfo, init?: RequestInit) => Promise&lt;Response&gt;_

  Custom [fetch](https://developer.mozilla.org/en-US/docs/Web/API/fetch) implementation.

## Language Models

You can create Perplexity models using a provider instance:

```ts
import { perplexity } from '@ai-sdk/perplexity';
import { generateText } from 'ai';

const { text } = await generateText({
  model: perplexity('sonar-pro'),
  prompt: 'What are the latest developments in quantum computing?',
});
```

### Sources

Websites that have been used to generate the response are included in the `sources` property of the result:

```ts
import { perplexity } from '@ai-sdk/perplexity';
import { generateText } from 'ai';

const { text, sources } = await generateText({
  model: perplexity('sonar-pro'),
  prompt: 'What are the latest developments in quantum computing?',
});

console.log(sources);
```

### Provider Options & Metadata

The Perplexity provider includes additional metadata in the response through `providerMetadata`.
Additional configuration options are available through `providerOptions`.

```ts
const result = await generateText({
  model: perplexity('sonar-pro'),
  prompt: 'What are the latest developments in quantum computing?',
  providerOptions: {
    perplexity: {
      return_images: true, // Enable image responses (Tier-2 Perplexity users only)
    },
  },
});

console.log(result.providerMetadata);
// Example output:
// {
//   perplexity: {
//     usage: { citationTokens: 5286, numSearchQueries: 1 },
//     images: [
//       { imageUrl: "https://example.com/image1.jpg", originUrl: "https://elsewhere.com/page1", height: 1280, width: 720 },
//       { imageUrl: "https://example.com/image2.jpg", originUrl: "https://elsewhere.com/page2", height: 1280, width: 720 }
//     ]
//   },
// }
```

The metadata includes:

- `usage`: Object containing `citationTokens` and `numSearchQueries` metrics
- `images`: Array of image URLs when `return_images` is enabled (Tier-2 users only)

You can enable image responses by setting `return_images: true` in the provider options. This feature is only available to Perplexity Tier-2 users and above.

### PDF Support

The Perplexity provider supports reading PDF files.
You can pass PDF files as part of the message content using the `file` type:

```ts
const result = await generateText({
  model: perplexity('sonar-pro'),
  messages: [
    {
      role: 'user',
      content: [
        {
          type: 'text',
          text: 'What is this document about?',
        },
        {
          type: 'file',
          data: fs.readFileSync('./data/ai.pdf'),
          mediaType: 'application/pdf',
          filename: 'ai.pdf', // optional
        },
      ],
    },
  ],
});
```

You can also pass the URL of a PDF:

```ts
{
  type: 'file',
  data: new URL('https://example.com/document.pdf'),
  mediaType: 'application/pdf',
  filename: 'document.pdf', // optional
}
```

The model will have access to the contents of the PDF file and
respond to questions about it.

<Note>
  For more details about Perplexity's capabilities, see the [Perplexity chat
  completion docs](https://docs.perplexity.ai/api-reference/chat-completions).
</Note>

### Search API

The Perplexity provider includes a search tool that gives you access to Perplexity's Search API. This tool is designed to be used with **other models** (OpenAI, Anthropic, Gemini, etc.) to give them web search capabilities powered by Perplexity.

<Note>
  Perplexity's Sonar models already have native search built-in, so you don't
  need to use this tool with them. Use this tool to add Perplexity search to
  other models.
</Note>

```ts
import { openai } from '@ai-sdk/openai';
import { perplexity } from '@ai-sdk/perplexity';
import { generateText, stepCountIs } from 'ai';

const { text, toolResults } = await generateText({
  model: openai('gpt-5-mini'),
  prompt:
    'What are the latest AI developments? Use search, then summarize the results.',
  tools: {
    search: perplexity.tools.search({
      max_results: 10,
    }),
  },
  stopWhen: stepCountIs(3),
});

console.log(text);

// Access search results
for (const toolResult of toolResults) {
  if (toolResult.toolName === 'search') {
    console.log('Search results:', toolResult.output.results);
  }
}
```

#### Search Configuration Options

The search tool supports extensive filtering and configuration:

**Basic Options:**

- `max_results` (1-20, default: 10): Number of search results to return
- `max_tokens_per_page` (default: 1024): Amount of text extracted per result page
- `country` (ISO 3166-1 alpha-2): Two-letter country code for regional results (e.g., "US", "GB")

**Domain Filtering:**

```ts
search: perplexity.tools.search({
  search_domain_filter: [
    'nature.com', // Include nature.com
    'science.org', // Include science.org
    'arxiv.org', // Include arxiv.org
  ],
});
```

**Language Filtering:**

```ts
search: perplexity.tools.search({
  search_language_filter: ['en', 'fr', 'de'], // ISO 639-1 codes (max 10)
});
```

**Date Range Filtering:**

```ts
search: perplexity.tools.search({
  search_after_date: '3/1/2025', // Format: MM/DD/YYYY
  search_before_date: '3/15/2025',
});
```

**Recency Filtering:**

```ts
search: perplexity.tools.search({
  search_recency_filter: 'week', // Options: 'day' | 'week' | 'month' | 'year'
});
```

<Note>
  `search_recency_filter` cannot be combined with `search_after_date` or
  `search_before_date`.
</Note>

#### Multi-Query Search

The search tool supports multi-query searches where the LLM can generate multiple search queries:

```ts
const { text } = await generateText({
  model: openai('gpt-5-mini'),
  prompt:
    'Search for information on AI safety, AGI development, and AI regulation as a json array. Then summarize the results.',
  tools: {
    search: perplexity.tools.search({ max_results: 10 }),
  },
  stopWhen: stepCountIs(3),
});
```

The LLM can generate a query array like `["AI safety research", "AGI development timeline", "AI regulation 2025"]`, and results from all queries are returned in a flat array.

#### Usage with ToolLoopAgent

You can also use the search tool with `ToolLoopAgent` for more complex search workflows:

```ts
import { openai } from '@ai-sdk/openai';
import { ToolLoopAgent } from 'ai';

const agent = new ToolLoopAgent({
  model: openai('gpt-5-mini'),
  tools: {
    search: perplexity.tools.search({
      max_results: 10,
    }),
  },
});

const { text, toolResults } = await agent.generate({
  prompt:
    'Research the latest developments in quantum computing. Then summarize the results.',
});
```

## Model Capabilities

| Model                 | Image Input         | Object Generation   | Tool Usage          | Tool Streaming      |
| --------------------- | ------------------- | ------------------- | ------------------- | ------------------- |
| `sonar-deep-research` | <Cross size={18} /> | <Check size={18} /> | <Cross size={18} /> | <Cross size={18} /> |
| `sonar-reasoning-pro` | <Check size={18} /> | <Check size={18} /> | <Cross size={18} /> | <Cross size={18} /> |
| `sonar-reasoning`     | <Check size={18} /> | <Check size={18} /> | <Cross size={18} /> | <Cross size={18} /> |
| `sonar-pro`           | <Check size={18} /> | <Check size={18} /> | <Cross size={18} /> | <Cross size={18} /> |
| `sonar`               | <Check size={18} /> | <Check size={18} /> | <Cross size={18} /> | <Cross size={18} /> |

<Note>
  Please see the [Perplexity docs](https://docs.perplexity.ai) for detailed API
  documentation and the latest updates.
</Note>
